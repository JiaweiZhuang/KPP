# Set here the Fortran77 compiler and the desired optimization options
COMPILER = GNU

FC_INTEL   = ifort
FOPT_INTEL = -O -f77rtl -mp -pc80 -prec_div -tpp7
FC_PGF     = pgf77
FOPT_PGF   = -O -fast -pc 80 -Kieee

FC_GNU     = gfortran
# use GEOS-Chem settings
FOPT_GNU   = -cpp -w -std=legacy -fautomatic -fno-align-commons \
                -fconvert=big-endian -fno-range-check -O3 -funroll-loops \
                                -fopenmp -mcmodel=medium -fbacktrace -g -ffast-math
FC_HPUX    = f90
FOPT_HPUX  = -O

FC   = $(FC_$(COMPILER))
FOPT = $(FOPT_$(COMPILER)) 

# Mathematical libraries: blas and lapack
# MATHLIB   = -L/usr/local/lib  -llapack_g77  -L/usr/lib -lblas_g77
MATHLIB   = -llapack  -lblas 

# To create Matlab mex gateway routines
# Note: use $(FC) as the mex Fortran compiler
MEX  = mex

HEADERS = saprc_f77_Global.h  saprc_f77_Parameters.h  saprc_f77_Sparse.h

SPSRC = saprc_f77_JacobianSP.f \
	saprc_f77_HessianSP.f  \
	saprc_f77_StoichiomSP.f

SPOBJ = saprc_f77_JacobianSP.o \
	saprc_f77_HessianSP.o  \
	saprc_f77_StoichiomSP.o


SRC =   saprc_f77_Main.f      saprc_f77_Integrator.f   \
        saprc_f77_Function.f  saprc_f77_Initialize.f   \
	saprc_f77_Jacobian.f  saprc_f77_LinearAlgebra.f\
	saprc_f77_Rates.f     saprc_f77_Hessian.f      \
	saprc_f77_Stoichiom.f saprc_f77_Util.f         \
	saprc_f77_Monitor.f   

OBJ =   saprc_f77_Main.o      saprc_f77_Integrator.o   \
        saprc_f77_Function.o  saprc_f77_Initialize.o   \
	saprc_f77_Jacobian.o  saprc_f77_LinearAlgebra.o\
	saprc_f77_Rates.o     saprc_f77_Hessian.o      \
	saprc_f77_Stoichiom.o saprc_f77_Util.o         \
	saprc_f77_Monitor.o

all:    exe

exe:	$(HEADERS) $(SPOBJ) $(OBJ)
	$(FC) $(FOPT) $(SPOBJ) $(OBJ) $(MATHLIB) -o saprc_f77.exe

mex:    $(HEADERS) $(SPOBJ) $(OBJ)
	$(MEX) FC#$(FC) -fortran -O saprc_f77_mex_Fun.f     $(SPOBJ) $(OBJ)
	$(MEX) FC#$(FC) -fortran -O saprc_f77_mex_Jac_SP.f  $(SPOBJ) $(OBJ)
	$(MEX) FC#$(FC) -fortran -O saprc_f77_mex_Hessian.f $(SPOBJ) $(OBJ)
	
clean:
	rm -f $(SPOBJ) $(OBJ) saprc_f77.exe saprc_f77.map  \
	saprc_f77.dat 

distclean:
	rm -f $(SPOBJ) $(OBJ) saprc_f77.exe saprc_f77.map  \
	saprc_f77.dat saprc_f77*.f  saprc_f77*.h 

saprc_f77_Monitor.o: saprc_f77_Monitor.f $(HEADERS)
	$(FC) $(FOPT) -c $<

saprc_f77_JacobianSP.o: saprc_f77_JacobianSP.f $(HEADERS)
	$(FC) $(FOPT) -c $<

saprc_f77_HessianSP.o: saprc_f77_HessianSP.f  $(HEADERS)
	$(FC) $(FOPT) -c $<

saprc_f77_StoichiomSP.o: saprc_f77_StoichiomSP.f $(HEADERS)
	$(FC) $(FOPT) -c $<

saprc_f77_Main.o: saprc_f77_Main.f  saprc_f77_Initialize.o $(HEADERS) $(SPOBJ)
	$(FC) $(FOPT) -c $<

saprc_f77_Integrator.o: saprc_f77_Integrator.f  $(HEADERS) $(SPOBJ)
	$(FC) $(FOPT) -c $<

saprc_f77_Initialize.o: saprc_f77_Initialize.f  $(HEADERS) $(SPOBJ)
	$(FC) $(FOPT) -c $<

saprc_f77_Function.o: saprc_f77_Function.f  $(HEADERS) $(SPOBJ)
	$(FC) $(FOPT) -c $<

saprc_f77_Jacobian.o: saprc_f77_Jacobian.f  $(HEADERS) $(SPOBJ)
	$(FC) $(FOPT) -c $<

saprc_f77_LinearAlgebra.o: saprc_f77_LinearAlgebra.f  $(HEADERS) $(SPOBJ)
	$(FC) $(FOPT) -c $<

saprc_f77_Rates.o: saprc_f77_Rates.f  $(HEADERS) $(SPOBJ)
	$(FC) $(FOPT) -c $<

saprc_f77_Hessian.o:  saprc_f77_Hessian.f $(HEADERS) $(SPOBJ)
	$(FC) $(FOPT) -c $<

saprc_f77_Stoichiom.o: saprc_f77_Stoichiom.f  $(HEADERS) $(SPOBJ)
	$(FC) $(FOPT) -c $<

saprc_f77_Util.o: saprc_f77_Util.f  $(HEADERS) $(SPOBJ)
	$(FC) $(FOPT) -c $<

